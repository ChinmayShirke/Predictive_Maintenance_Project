<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Predictive Maintenance | Made by - Chinmay Shirke</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<style>
    body {
        background-color: #f9f9f9;   /* Light grayish green */
        font-family: 'Segoe UI', sans-serif;
        color: #0d2818;
    }

    .navbar {
        background: #030f0c;  /* Dark green */
    }

    .navbar-brand {
        font-weight: bold;
        letter-spacing: 1px;
    }

    .card {
        border-radius: 14px;
        background-color: #ffffff;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        border: none;
    }

    .kpi-card {
        text-align: center;
        padding: 20px;
    }

    .kpi-value {
        font-size: 34px;
        font-weight: 700;
        color: #0b3b2d; /* Dark green */
    }

    th {
        background-color: #d8e3dd; /* Very light green-gray */
        color: #0b3d2e;
    }

    .footer {
        margin-top: 40px;
        padding: 20px;
        background: #0b3d2e;
        color: white;
        text-align: center;
        letter-spacing: 0.5px;
    }

    .alert-success {
        background-color: #bfe7cc;
        color: #0b3d2e;
    }

    .alert-warning {
        background-color: #ffe9b5;
        color: #8a6d1d;
    }

    .alert-danger {
        background-color: #ffb8b8;
        color: #7a0d0d;
    }

    
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-dark navbar-expand-lg">
    <div class="container-fluid px-4">
        <a class="navbar-brand text-white" href="#">
            <i class="bi bi-gear-wide-connected"></i> AI POWERED SMART MANUFACTURING - Chinmay 
        </a>

        <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navMenu">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navMenu">
           
        </div>
    </div>
</nav>

<!-- MAIN CONTENT -->
<div class="container my-5">

    <h2 class="mb-1 fw-bold text-dark">Predictive Maintenance Dashboard</h2>
    <p class="text-secondary mb-4">Real-time health monitoring powered by Machine Learning</p>

    <div id="alertBox" class="alert text-center" role="alert">
        Loading latest machine data...
    </div>

    <!-- KPIs -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card kpi-card">
                <div class="text-secondary">Remaining Useful Life (Hours)</div>
                <div id="rulValue" class="kpi-value text-primary">--</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card kpi-card">
                <div class="text-secondary">Machine Status</div>
                <div id="status" class="kpi-value text-success">--</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card kpi-card">
                <div class="text-secondary">Temperature (°C)</div>
                <div id="temperature" class="kpi-value">--</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card kpi-card">
                <div class="text-secondary">Vibration (mm/s)</div>
                <div id="vibration" class="kpi-value">--</div>
            </div>
        </div>
    </div>

    <!-- SENSOR DATA TABLE -->
     <div class="card p-4">
        <h4 class="mb-3">Machine Pressure Trend</h4>
        <p class="text-muted">Live pressure trend from sensor_data</p>
        <canvas id="pressureChart" style="height:300px;"></canvas>
    </div>
    <!-- CHARTS -->

<!-- FOOTER -->
<div class="footer">
   Predictive Analytics for Smart Manufacturing <br>
    <strong>Made by: Chinmay Shirke</strong>
</div>

<!-- JAVASCRIPT -->
<script>
async function fetchLatest() {
    try {
        const response = await fetch("/latest");
        const result = await response.json();

        document.getElementById("rulValue").innerHTML = result.rul ?? "--";

        const alertBox = document.getElementById("alertBox");
        alertBox.className = "alert text-center alert-" + result.alert;

        alertBox.innerHTML =
            result.alert === "danger" ? "⚠️ CRITICAL: Machine Failure Likely Soon!" :
            result.alert === "warning" ? "⚠️ Warning — Maintenance Recommended" :
            result.alert === "success" ? "✅ Machine Operating Normally" :
            "ℹ️ " + result.alert;

        const data = result.data || {};
        Object.keys(data).forEach(key => {
            if (document.getElementById(key)) {
                document.getElementById(key).innerHTML = data[key];
            }
        });

    } catch (err) {
        console.error("Error fetching data:", err);
    }
}

setInterval(fetchLatest, 3000);
fetchLatest();

<!-- checking -->
        const ctx = document.getElementById("pressureChart").getContext("2d");
        let pressureData = [];
        let timeLabels = [];

       const chart = new Chart(ctx, {
    type: "line",
    data: {
        labels: timeLabels,
        datasets: [{
            label: "Pressure",
            data: pressureData,
            borderColor: "blue",
            fill: false,
            tension: 0.3
        }]
    },
    options: {
        responsive: true,
        scales: {
            x: {
                title: { display: true, text: "Time" }
            },
            y: {
                title: { display: true, text: "Pressure" },
                min: 20,  // minimum Y-axis value
                max: 39,  // maximum Y-axis value
                ticks: {
                    stepSize: 0.1  // step between ticks (optional)
                }
            }
        }
    }
});


        async function fetchData() {
            const res = await fetch("/latest");
            const json = await res.json();
            const data = json.data;
            if (!data || !data.pressure) return;

            const pressure = data.pressure;
            const time = new Date().toLocaleTimeString();

            pressureData.push(pressure);
            timeLabels.push(time);

            if (pressureData.length > 20) {
                pressureData.shift();
                timeLabels.shift();
            }

            chart.update();
        }

        // Auto-update every 10 seconds
        setInterval(fetchData, 10000);

</script>

</body>
</html>
